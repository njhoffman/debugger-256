{"version":3,"sources":["../lib/settings.js"],"names":["fs","require","path","appRoot","merge","cloneDeep","internalLog","defaultOptions","colors","keys","fg","number","grayscale","customColors","bold","blue","lightBlue","darkBlue","red","lightRed","darkRed","green","lightGreen","darkGreen","purple","lightPurple","darkPurple","cyan","lightCyan","darkCyan","yellow","orange","white","gray","fatal","error","warn","log","info","debug","trace","colorTag","options","getOptions","subsystems","getSubsystems","addSubsystem","ss","length","indexOf","push","conf","getConf","fileChange","fileName","loadConfFile","readConfFile","loc","content","readFileSync","JSON","parse","e","checkConfLocation","existsSync","unwatchFile","watchFile","interval","bind","undefined","currLocation","resolve","__dirname","rootLocation","toString","resetSettings","initSettings","customOptions","exports"],"mappings":"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","file":"settings.js","sourcesContent":["const fs = require('fs');\nconst path = require('path');\nconst appRoot = require('app-root-path');\nconst { merge, cloneDeep } = require('lodash');\nconst { internalLog } = require('./console');\n\nlet defaultOptions = {\n  /* prettyjson-256 options */\n  colors:     {\n    keys:    { fg:  [0, 2, 1] },\n    number:  { fg: { grayscale: 11 } }\n  },\n  customColors : {\n    bold:                     { grayscale: 23 },\n    blue:                     { fg: [0, 0, 4] },\n    lightBlue:                { fg: [0, 1, 5] },\n    darkBlue:                 { fg: [0, 0, 3] },\n    red:                      { fg: [3, 0, 0] },\n    lightRed:                 { fg: [5, 0, 0] },\n    darkRed:                  { fg: [1, 0, 0] },\n    green:                    { fg: [0, 3, 0] },\n    lightGreen:               { fg: [0, 5, 0] },\n    darkGreen:                { fg: [0, 1, 0] },\n    purple:                   { fg: [1, 0, 3] },\n    lightPurple:              { fg: [2, 0, 5] },\n    darkPurple:               { fg: [1, 0, 1] },\n    cyan:                     { fg: [2, 3, 4] },\n    lightCyan:                { fg: [2, 5, 5] },\n    darkCyan:                 { fg: [1, 2, 3] },\n    yellow:                   { fg: [4, 5, 0] },\n    orange:                   { fg: [5, 2, 0] },\n    white:                    { fg: [0, 3, 0] },\n    gray:                     { grayscale: 12 },\n\n    fatal:                    { fg: [5, 0, 0] },\n    error:                    { fg: [4, 0, 0] },\n    warn:                     { fg: [4, 1, 0] },\n    log:                      { fg: [1, 2, 4] },\n    info:                     { fg: [2, 3, 4] },\n    debug:                    { fg: [3, 3, 4] },\n    trace:                    { fg: [3, 4, 4] }\n  },\n  /* debugger-256 options */\n  colorTag: 'color'\n};\nlet options = cloneDeep(defaultOptions);\nexport let getOptions = () => options;\n\nlet subsystems = [];\nexport const getSubsystems = () => subsystems;\nexport const addSubsystem = (ss) => {\n  if (ss && ss.length > 0 && subsystems.indexOf(ss) === -1) {\n    subsystems.push(ss);\n  }\n};\n\nlet conf = false;\nexport const getConf = () => conf;\n\nconst fileChange = (fileName) => {\n  internalLog(`Detected file change in: ${fileName}, reinitializing debugger-256`);\n  conf = loadConfFile();\n};\n\nconst readConfFile = (loc) => {\n  const content = fs.readFileSync(loc);\n  try {\n    conf = JSON.parse(content);\n    return conf;\n  } catch (e) {\n    internalLog('Error parsing configuration file', e);\n    return false;\n  }\n};\n\nconst checkConfLocation = (loc) => {\n  if (fs.existsSync(loc)) {\n    !conf && internalLog(`Found debugger-256 configuration file: ${loc}, applying settings and watching for changes`);\n    fs.unwatchFile(loc);\n    fs.watchFile(loc, { interval: 500 }, fileChange.bind(undefined, loc));\n    return true;\n  }\n  return false;\n};\n\nexport const loadConfFile = () => {\n  // TODO: implement error handling\n  const currLocation = path.resolve(__dirname, '.debugger-256');\n  const rootLocation = path.resolve(appRoot.toString(), '.debugger-256');\n  if (checkConfLocation(currLocation)) {\n    return readConfFile(currLocation);\n  } else if (checkConfLocation(rootLocation)) {\n    return readConfFile(rootLocation);\n  }\n  return false;\n};\n\nexport const resetSettings = () => {\n  subsystems = [];\n  options = cloneDeep(defaultOptions);\n  return options;\n};\n\nexport const initSettings = (customOptions) => {\n  if (customOptions) {\n    merge(options, customOptions);\n  } else {\n    conf = exports.loadConfFile();\n    if (conf && conf['_debugger-256']) {\n      merge(options, conf['_debugger-256']);\n    }\n  }\n  return options;\n};\n\nexports.initSettings();\n"]}